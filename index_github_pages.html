<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚ˆãä½¿ã†ç‚¹ç¾¤å‡¦ç† - GitHub Pagesç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .status {
            padding: 15px;
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .status.success {
            background: #d4edda;
            border-color: #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            border-color: #f5c6cb;
        }

        .upload-section {
            margin-bottom: 30px;
        }

        .file-input-wrapper {
            margin-bottom: 20px;
        }

        .file-input-label {
            display: block;
            padding: 20px;
            background: #f8f9fa;
            border: 2px dashed #ddd;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-input-label:hover {
            background: #e9ecef;
            border-color: #667eea;
        }

        .file-input-label.has-file {
            background: #e7f5ff;
            border-color: #667eea;
        }

        input[type="file"] {
            display: none;
        }

        .file-drop-zone {
            border: 2px dashed transparent;
            border-radius: 10px;
            padding: 8px 0;
            transition: border-color 0.2s, background 0.2s;
        }

        .file-drop-zone.drag-over {
            border-color: #667eea;
            background: #e7f5ff;
        }

        .process-mode-section {
            background: #f0f4ff;
            border: 1px solid #667eea;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .process-mode-label {
            display: block;
            font-size: 1.15em;
            font-weight: 700;
            color: #333;
            margin-bottom: 12px;
        }

        .process-mode-radios {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .settings {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .setting-item {
            margin-bottom: 15px;
        }

        .setting-item:last-child {
            margin-bottom: 0;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 600;
            font-size: 14px;
        }

        input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .process-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .process-btn:hover:not(:disabled) {
            transform: translateY(-2px);
        }

        .process-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .progress-section {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .progress-section.active {
            display: block;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e9ecef;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: 600;
        }

        .log {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #555;
            max-height: 300px;
            overflow-y: auto;
            background: white;
            padding: 10px;
            border-radius: 5px;
        }

        .log-entry {
            margin-bottom: 5px;
        }

        .result-section {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 10px;
        }

        .result-section.active {
            display: block;
        }

        .download-btn {
            display: inline-block;
            padding: 12px 24px;
            background: #28a745;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            margin-top: 10px;
            transition: background 0.3s;
        }

        .download-btn:hover {
            background: #218838;
        }

        .file-info {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .github-badge {
            display: inline-block;
            padding: 5px 10px;
            background: #24292e;
            color: white;
            border-radius: 5px;
            font-size: 12px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ ã‚ˆãä½¿ã†ç‚¹ç¾¤å‡¦ç†</h1>
        <p class="subtitle">æ•°å­¦åº§æ¨™ç³»ã®ç‚¹ç¾¤ã‚’å‡¦ç†ã™ã‚‹ãƒ„ãƒ¼ãƒ«ç¾¤ï¼ˆGitHub Pagesç‰ˆï¼‰</p>
        
        <div class="status" id="status">
            â³ LAZè§£å‡ã‚¨ãƒ³ã‚¸ãƒ³ã‚’åˆæœŸåŒ–ã—ã¦ã„ã¾ã™...
        </div>

        <div class="upload-section">
            <div class="process-mode-section">
                <label class="process-mode-label">å‡¦ç†ãƒ¢ãƒ¼ãƒ‰</label>
                <div class="process-mode-radios">
                    <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-weight: normal;">
                        <input type="radio" name="processMode" id="processModeCenter" value="center" checked>
                        ä¸­å¿ƒæŠ½å‡ºï¼ˆCSVåº§æ¨™å‘¨è¾ºã®ç‚¹ã‚’æŠ½å‡ºï¼‰
                    </label>
                    <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-weight: normal;">
                        <input type="radio" name="processMode" id="processModeBoundary" value="boundary">
                        ç«‹é¢å›³ä½œæˆï¼ˆå¢ƒç•Œã®å†…å´ã‹ã‚‰å¤–å´ã‚’è¦‹é€šã™åº§æ¨™ç³»ã«å¤‰æ›ï¼‰
                    </label>
                    <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-weight: normal;">
                        <input type="radio" name="processMode" id="processModeSection" value="section">
                        ç¸¦æ–­ãƒ»æ¨ªæ–­å›³ä½œæˆï¼ˆABç›´ç·šä»˜è¿‘ã‚’æŠ½å‡ºâ†’åº§æ¨™å¤‰æ›ï¼‰
                    </label>
                    <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-weight: normal;">
                        <input type="radio" name="processMode" id="processModePolygon" value="polygon">
                        å¢ƒç•Œãƒãƒªã‚´ãƒ³ï¼ˆSIMAå½¢å¼ï¼‰ã‚’ç‚¹ç¾¤ä¸Šã«å¯è¦–åŒ–
                    </label>
                    <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-weight: normal;">
                        <input type="radio" name="processMode" id="processModeTarget" value="target">
                        ã‚¿ãƒ¼ã‚²ãƒƒãƒˆé…ç½®ï¼ˆå››éš…ï¼‰
                    </label>
                </div>
            </div>

            <div id="fileDropZone" class="file-drop-zone">
                <div class="file-input-wrapper">
                    <label for="lazFile" class="file-input-label" id="lazLabel">
                        <strong>ğŸ“ LAZ/LASãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</strong>
                        <div class="file-info" id="lazInfo">âœ… LAZåœ§ç¸®ãŠã‚ˆã³LASéåœ§ç¸®ã®ä¸¡æ–¹ã«å®Œå…¨å¯¾å¿œï¼ˆãƒ–ãƒ©ã‚¦ã‚¶å†…å‡¦ç†ï¼‰</div>
                    </label>
                    <input type="file" id="lazFile" accept=".laz,.las">
                </div>

                <div class="file-input-wrapper" id="csvSection">
                    <label for="csvFile" class="file-input-label" id="csvLabel">
                        <strong>ğŸ“Š CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</strong>
                        <div class="file-info" id="csvInfo">å½¢å¼: label,x,y,z</div>
                    </label>
                    <input type="file" id="csvFile" accept=".csv">
                </div>

                <div class="file-input-wrapper" id="simSection" style="display: none;">
                    <label for="simFile" class="file-input-label" id="simLabel">
                        <strong>ğŸ“ SIMAå½¢å¼ï¼ˆ.simï¼‰å¢ƒç•Œãƒãƒªã‚´ãƒ³ã‚’é¸æŠ</strong>
                        <div class="file-info" id="simInfo">æ¸¬é‡åº§æ¨™ç³»ã§ä½œæˆã—ãŸç”»åœ°SIMAã‚’é¸æŠ</div>
                    </label>
                    <input type="file" id="simFile" accept=".sim">
                    </div>
            </div>

            <div id="boundarySection" style="display: none;" class="settings">
                <h4 style="margin-bottom: 10px;">æ¸¬é‡åº§æ¨™ç³»ã§ï¼’ç‚¹ã®åº§æ¨™å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆXYZåº§æ¨™ãƒ»Zã¯ã‚¹ãƒ•ã‚£ã‚¢ä¸­å¿ƒã«ä½¿ç”¨ï¼‰</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                    <div class="setting-item">
                        <label for="pointAX">ç‚¹A X (m)</label>
                        <input type="number" id="pointAX" step="any" placeholder="xA">
                    </div>
                    <div class="setting-item">
                        <label for="pointAY">ç‚¹A Y (m)</label>
                        <input type="number" id="pointAY" step="any" placeholder="yA">
                    </div>
                    <div class="setting-item">
                        <label for="pointAZ">ç‚¹A Z (m)</label>
                        <input type="number" id="pointAZ" step="any" placeholder="zAï¼ˆçœç•¥å¯ï¼‰">
                    </div>
                    <div class="setting-item">
                        <label for="pointBX">ç‚¹B X (m)</label>
                        <input type="number" id="pointBX" step="any" placeholder="xB">
                    </div>
                    <div class="setting-item">
                        <label for="pointBY">ç‚¹B Y (m)</label>
                        <input type="number" id="pointBY" step="any" placeholder="yB">
                    </div>
                    <div class="setting-item">
                        <label for="pointBZ">ç‚¹B Z (m)</label>
                        <input type="number" id="pointBZ" step="any" placeholder="zBï¼ˆçœç•¥å¯ï¼‰">
                    </div>
                </div>
                <p style="font-size: 12px; color: #666; margin-top: 5px;">Aãƒ»Bå„ç‚¹ã‚’ä¸­å¿ƒã«åŠå¾„0.01mãƒ»ç´„50ç‚¹ã®ã‚¹ãƒ•ã‚£ã‚¢ç‚¹ç¾¤ï¼ˆãƒã‚¼ãƒ³ã‚¿ï¼‰ã‚’ã€åº§æ¨™å¤‰æ›å‰ã«è¿½åŠ ã—ã¾ã™ã€‚</p>
                <div class="setting-item" style="margin-top: 10px;">
                    <label for="boundaryDirection">X'è»¸ã®å‘ãï¼ˆã©ã¡ã‚‰ã‚’ã€Œå·¦ã€ã«ã™ã‚‹ã‹ï¼‰</label>
                    <select id="boundaryDirection">
                        <option value="aLeftBRight">Aã‚’å·¦ãƒ»Bã‚’å³ï¼ˆX'ã¯ Aâ†’B æ–¹å‘ï¼‰</option>
                        <option value="bLeftARight">Bã‚’å·¦ãƒ»Aã‚’å³ï¼ˆX'ã¯ Bâ†’A æ–¹å‘ï¼‰</option>
                    </select>
                </div>
                <div class="setting-item" style="margin-top: 10px;">
                    <label for="scaleY">æ¨™é«˜ã®å¼·èª¿ï¼ˆå€ç‡ï¼‰</label>
                    <input type="number" id="scaleY" value="1" step="any" min="0.001">
                    <small style="color: #666; font-size: 12px;">ç¸¦æ–­å›³ã®Yï¼ˆæ¨™é«˜ï¼‰ã‚’ã“ã®å€ç‡ã§å¼·èª¿ã—ã¾ã™ã€‚1ã®ã¨ãå¤‰æ›´ãªã—ã€‚</small>
                </div>
            </div>

            <div id="sectionSettings" style="display: none;" class="settings">
                <h4 style="margin-bottom: 10px;">åˆ‡æŠœè¨­å®šï¼ˆç¸¦æ–­ãƒ»æ¨ªæ–­å›³ä½œæˆï¼‰</h4>
                <div class="setting-item">
                    <label for="clipWidth">åˆ‡æŠœå¹…ï¼ˆÂ±, mï¼‰</label>
                    <input type="number" id="clipWidth" value="0.01" min="0" step="any">
                    <small style="color: #666; font-size: 12px;">ABç›´ç·šï¼ˆç„¡é™é•·ï¼‰ã«å¯¾ã™ã‚‹æ¨ªæ–¹å‘è·é›¢ |Y'| ãŒã“ã®å€¤ä»¥å†…ã®ç‚¹ã ã‘ã‚’æ®‹ã—ã¾ã™ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: Â±0.01mï¼‰ã€‚</small>
                </div>
            </div>

            <div id="polygonSettings" style="display: none;" class="settings">
                <h4 style="margin-bottom: 10px;">å¢ƒç•Œãƒãƒªã‚´ãƒ³ï¼ˆSIMAï¼‰ã®ç·šå¹…</h4>
                <div class="setting-item">
                    <label for="polygonLineWidth">ç·šå¹… (m)</label>
                    <input type="number" id="polygonLineWidth" value="0.01" min="0.001" step="any">
                    <small style="color: #666; font-size: 12px;">å¢ƒç•Œã«æ²¿ã£ãŸå¸¯ã®å¹…ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ 0.01 = 1cmã€‚å†…å´ãƒ»å¤–å´ã«åŠåˆ†ãšã¤ã‚ªãƒ•ã‚»ãƒƒãƒˆã—ã¾ã™ã€‚</small>
                </div>
            </div>

            <div id="targetSettings" style="display: none;" class="settings">
                <h4 style="margin-bottom: 10px;">ã‚¿ãƒ¼ã‚²ãƒƒãƒˆé…ç½®ã®è¨­å®š</h4>
                <div class="setting-item">
                    <label for="targetSize">ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚µã‚¤ã‚º (m)</label>
                    <input type="number" id="targetSize" value="0.2" min="0.01" step="any">
                    <small style="color: #666; font-size: 12px;">å››éš…ã«é…ç½®ã™ã‚‹ç™½é»’ãƒã‚§ãƒƒã‚«ãƒ¼ã®1è¾ºã®é•·ã•ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ 0.2mã€‚</small>
                </div>
                <div class="setting-item" style="margin-top: 10px;">
                    <label>ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®é«˜ã•ï¼ˆZï¼‰</label>
                    <div style="display: flex; gap: 16px; margin-top: 6px;">
                        <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-weight: normal;">
                            <input type="radio" name="targetZ" value="minZ" checked>
                            minZï¼ˆä¸‹é¢ï¼‰
                        </label>
                        <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-weight: normal;">
                            <input type="radio" name="targetZ" value="maxZ">
                            maxZï¼ˆä¸Šé¢ï¼‰
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <div class="settings" id="centerSettings">
            <div class="setting-item">
                <label>ãƒ•ã‚£ãƒ«ã‚¿ç¨®åˆ¥ï¼ˆã©ã¡ã‚‰ã‹ã¾ãŸã¯ä¸¡æ–¹ï¼‰</label>
                <div style="display: flex; gap: 20px; flex-wrap: wrap; margin-top: 8px;">
                    <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-weight: normal;">
                        <input type="checkbox" id="filterSphere" checked>
                        ã‚¹ãƒ•ã‚£ã‚¢ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆ3D: X,Y,Z ã®çƒå†…ï¼‰
                    </label>
                    <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-weight: normal;">
                        <input type="checkbox" id="filterHorizontal">
                        æ°´å¹³æŠ•å½±ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆXYå¹³é¢ã®å††å†…ã€Zã¯ç„¡è¦–ï¼‰
                    </label>
                </div>
                <small style="color: #666; font-size: 12px;">ä¸¡æ–¹ã‚ªãƒ³ãªã‚‰ã€ã©ã¡ã‚‰ã‹ã®æ¡ä»¶ã‚’æº€ãŸã™ç‚¹ã‚’æŠ½å‡ºã—ã¾ã™ã€‚</small>
            </div>
            <div class="setting-item">
                <label for="radius">æŠ½å‡ºåŠå¾„ (ãƒ¡ãƒ¼ãƒˆãƒ«)</label>
                <input type="number" id="radius" value="0.5" min="0.1" step="0.1">
            </div>
            <div class="setting-item">
                <label for="chunkSize">ãƒãƒ£ãƒ³ã‚¯ã‚µã‚¤ã‚º (MB) - å¤§ãã„ã»ã©é«˜é€Ÿï¼ˆæ¨å¥¨: 100-500MBï¼‰</label>
                <input type="number" id="chunkSize" value="100" min="10" max="1000" step="50">
                <small style="color: #666; font-size: 12px;">
                    å¤§ããªãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ1GBä»¥ä¸Šï¼‰ã®å ´åˆã€ãƒãƒ£ãƒ³ã‚¯ã‚µã‚¤ã‚ºã‚’å¤§ããï¼ˆ500-1000MBï¼‰ã™ã‚‹ã¨å‡¦ç†é€Ÿåº¦ãŒå‘ä¸Šã—ã¾ã™ã€‚<br>
                    <strong>æ³¨æ„:</strong> LAZãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆã¯ãƒãƒ£ãƒ³ã‚¯ã‚µã‚¤ã‚ºã®å½±éŸ¿ã¯é™å®šçš„ã§ã™ï¼ˆãƒã‚¤ãƒ³ãƒˆå˜ä½ã§å‡¦ç†ã™ã‚‹ãŸã‚ï¼‰ã€‚<br>
                    éåœ§ç¸®LASãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆã®ã¿ã€ãƒãƒ£ãƒ³ã‚¯ã‚µã‚¤ã‚ºãŒåŠ¹æœçš„ã§ã™ã€‚å‡¦ç†å¾Œã«ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
                </small>
            </div>
        </div>

        <button class="process-btn" id="processBtn" disabled>å‡¦ç†ã‚’é–‹å§‹</button>

        <div class="progress-section" id="progressSection">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill">0%</div>
            </div>
            <div class="log" id="log"></div>
        </div>

        <div class="result-section" id="resultSection">
            <h3>âœ… å‡¦ç†å®Œäº†</h3>
            <p id="resultText"></p>
            <a class="download-btn" id="downloadBtn" download="output.las">LASã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
            <a class="download-btn" id="downloadCsvBtn" download="centers_updated.csv" style="display:none; margin-left:10px;">æ›´æ–°ã•ã‚ŒãŸCSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
        </div>

        <div class="github-badge">
            ğŸŒ GitHub Pageså¯¾å¿œ - å®Œå…¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å‡¦ç†
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/clipper-lib@6.4.2/clipper.js"></script>
    <script type="module" src="app_github_pages.js"></script>
</body>
</html>
